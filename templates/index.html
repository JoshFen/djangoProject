<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <style>
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }

      #layout{
          display: grid;
          grid-template-areas: "map title"
                               "map title"
                               "map title"
                               "map title";
          grid-template-columns: 80% 1fr;
      }

      #search{
          grid-area: title;
          display: grid;
          grid-template-areas: "heading"
                               "from-loc"
                               "destination"
                               "go-button";
          grid-template-rows: 50px 40px 40px 1fr;
          grid-gap: 20px;
      }

      #map {
        /* configure the size of the map */
        width: 100%;
        height: 100%;
        border: cadetblue 10px;
        grid-area: map;
      }

      #route-mapper{
          text-align: center;
          grid-area: heading;
      }

      #from{
          grid-area: from-loc;
      }

      #to{
          grid-area: destination;
      }

      .input {
          margin-left: 10px;
          margin-right: 10px;
      }

      #submit{
          grid-area: go-button;
          display: inline-block;
          text-align: center;
          width: 200px;
          height: 50px;
          margin-left: 25%;
      }
    </style>
  </head>

  {% block content %}
  <body id="layout">
    <div id="search">
        <h2 id="route-mapper">Route Mapper</h2>

        <select class="input" id="from">
            {% for node in ways %}
                <option value="  "> {{node}} </option>
            {% endfor %}
        </select>

        <select class="input" id="to">
            {% for node in ways %}
                <option value="{{ node }}"> {{node}} </option>
            {% endfor %}
        </select>

        {% csrf_token %}
        <button id="submit" type="button">GO</button>
    </div>
    <div id="map"></div>
    <script>
      // initialize Leaflet
      var map = L.map('map').setView({lon: -75.5183, lat: 40.8153}, 16);

      const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

      // add the OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        minZoom: 16,
        attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
      }).addTo(map);

      // show the scale bar on the lower left corner
      L.control.scale({imperial: true, metric: true}).addTo(map);

      // show a marker on the map
      L.marker({lon: -75.516582, lat: 40.81357}).bindPopup('The center of the world').addTo(map);

      var btn = document.getElementById("submit");
      btn.addEventListener('click', route);

      function route(){
          var select = document.getElementById("from");
          var start = select.options[select.selectedIndex].value;
          var select = document.getElementById("to");
          var end = select.options[select.selectedIndex].value;
          console.log(start);
          console.log(end)


          $(document).ready(function () {
          var data = [start, end]
          var dataJ = JSON.stringify(data)
          console.log(dataJ)
          $.ajax({
                headers: {'X-CSRFTOKEN': csrftoken},
                type: 'POST',
                url: '/handle_request/ ',
                data: {data: dataJ},
                success: function (data) {
                },
                error: function(data) {
                    console.log("here");

                }
            });
          });

      }

    </script>
  </body>
{% endblock content %}
</html>